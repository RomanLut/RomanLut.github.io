                               
              McadRus v1.0 Copyright (C) 1995 by LoutSoft

  Программа позволяет пользоваться русскими буквами и вставлять картинки
при работе в системе MathCad v2.01 (C) MathSoft.

1. Поместите файл mcadrus.com в каталог с программой mcad.exe
2. Запустите mcadrus.com
   Примечание. Совмесно с mcadrus не нужно и не рекомендуется использовать
               всякие русификаторы клавиатуры и принтера - программа
               использует внутренние русификаторы и использование внешних
               может привести к сбоям в работе программы. Однако, 
               mcadrus опознает присутствие в памяти русификатора rk.com
               _если_он_запущен_непосредственно_перед_mcadrus.com и не
               включает внутренний русификатор. Если вы все-же хотите 
               использовать внешний драйвер клавиатуры, отключите внутренний
               используя ключ /K (mcadrus /k).
               Если вы хотите использовать другой шрифт, укажите имя файла 
               со шрифтом в командной строке (напр. mcadrus ibm.fnt).
               При использовании mcadrus mcad всегда будет использовать
               CGA режим 640x200 независимо от того, какой у вас 
               видеоадаптер (кстати, с адаптером HERCULES программа работать
               не будет). 

  Переключение на руские буквы (если используется внутренний русификатор
клавиатуры) - LeftShift+RightShift. Русские буквы нельзя использовать
(по крайней мере, большинство) как имена переменных, матриц; можно
свободно использовать в коментариях ("..."). Индикатором RUS/AT  при
этом служит индикатор Scrool Lock (но это на AT и при том с AMI BIOS-ом).
  Для того, что-бы вставить картинку в редактируемый файл, введите следующий
коментарий:

  "@filename.ext,fromx,fromy,sixex,sizey;", где

   filename.ext - имя и путь к файлу с картинкой. Файл с картинкой рисуется в
                  любом CGA графическом редакторе (например PCI). Затем 
                  запустите программу cgagrab.com (или cgasave.com для 
                  ПОИСК 1), запустите редактор, выведите картинку на весь 
                  екран и нажмите ALT-G (CAPS для ПОИСКа 1) - копия екрана 
                  запишется в файл grab_a.cga (grab_b.cga,если grab_a.cga 
                  уже существует; на ПОИСКЕ 1 имя файла ввдоиться непосред-
                  ственно с клавиатуры на запрос программы) в активном 
                  каталоге. Размер такого файла 16384 байт и он представляет
                  собой точную копию видеопамяти в режимах 4,5,6.
  fromx,fromy  -  [0..79],[0..23] координаты верхнего левого угла прямоуголь-
                  ника-картинки
  sizex,sizey     [0..79],[0..25] размеры прямоугольника-картинки
 
  Наличие "@", разделяющих запятых и ";" в конце обязательно. Вывод картинки
производиться после полного ввода коментария. Для этого нажмите CTRL+R.
Картинка будет выведена на екран только если описанный выше коментарий 
находиться на экране, т.е. если коментарий находиться в строке 1, а на 
экране показаны строки файла 2-25, картинка не будет видна.
  Для показа картинки она загружается во внутренний буфер и для повторного
показа обращения к диску не потребуется. В файл можно вставлять неколько 
картинок; в буфере может содержаться только одна - поэтому программа будет
загружать другую картинку в буфер на место первой и наоборот. 

  Использование различных шрифтов
Можно использовать _любой_ шрифт какой вам нравиться. Для его редактирова-
ния удобно использовать программу font.exe by Flambeaux Software, режим
8x8,Range 0-255. Для использования другого шрифта укажите "mcadrus myfont.fnt".
В поставку входят 2 файла со щрифтами:
 russian.fnt  - шрифт с русскими буквами
 mcadfont.fnt - шрифт как в обычном mathcad'e
При использовании русского шрифта много математических символов (напр. ПИ)
заменяются на русские буквы, поэтому от них прийдется отказаться (можно,
конечно, нарисовать свой шрифт).
 Macdrus использует по умолчанию встроенный в нее шрифт russian.fnt.
Можно изменить любые буквы в шрифте, однако имейте в виду, что английские
буквы используються также для отображения меню.

  Печать файлов

Поддерживаются только Epson-совместимый графический принтер, при этом не 
требуется, что бы он был апаратно русифицирован. В меню mcad "Select Printer"
должен быть выбран Epson. 
  При печати файлов коментарий "@filename,x,y,x,y," не печатается, но:
после картинки печатается столько пустых строк, сколько заняла картинка,
поэтому перед печатью необходимо пододвинуть текст, который находиться ниже 
картинки, вплотную в коментарию. Сама программа mcad воспринимает коментарий 
как одну строку, а при печати их получается больше - поэтому вы сами должны 
просчитась количество строк, которые надо вывести на принтер, чтобы все 
вместилось на лист бумаги.
  Для того, чтобы картинка правильно вывелась на принтер, с строке с
коментарием слева от него не должно быть никаких выражений (коментарии
можно).
  Перед печатью рекомендуется просмотреть печатаемую страницу, чтобы
картинка загрузилась во внутренний буфер и ее не потребовалось загружать
с диска во время печати - а не то возможно зависание с некоторыми версиями
ДОС (проблемы с повторной входимостью в прерывание 21h).
  Если вы вдруг решили прервать печать, а ctrl-a не работает - просто 
выключите приннтер на 5 сeк.
  Поддерживается только принтер, подключенный к LPT1:.

  Простейшая русификация Mcad 
Просто запишите файл mc8x8.mcf наверх старого в каталог MCAD.
При этом не требуется использование других программ из поставки.
Не забудьте загрузить русификатор клавиатуры и принтера.

 Практически для работы требуется лишь программа mcadrus.com, наличие
остальных файлов необязательно.

  Подробности

Для усовершенствования не не изменяю ни одного байта в mcad.exe.
Принцип прост - перехватываются прерывания 10h,17h и производиться
отслеживание вывода символа "@". Кроме того для русификации клавиатуры 
перехватывается прерывание 9. Затем функцией exec запускается mcad.exe.
Mcadrus в памяти занимает ~24k.
 Печать на принтер производиться полностью в графическом режиме - загрузка
шрифта в принтер не используется, т.к. не на всех это работает. Однако это
привело к значительному снижению скорости печати.

Список файлов:

mcadrus.com  - основная программа
mcadrus.doc  - это описание  
mcadrus.asm  - исходник (выглядит неакуратно, т.к. я его склеил из 3
               программ и не коментировал, ксати спасибо Onishchenko A.N.
               за исходник русификатора клавиатуры)
mcadrus.cga  - заставка для mcadrus.com
assemble.doc - инструкция по сборке mcadrus.com

cgagrab.com  - программа для записи картинок в файл
cgasave.com  - программа для записи картинок в файл на ПОИСКе 1

font.exe     - программа для редактирования шрифтов

russian.fnt  - шрифт
mcadfont.fnt - шрифт

toe.mcd      - пример использования нововведений
toe.cga      - картинка для примера

mc8x8.mcf    - файл для простейшей русификации

End.
